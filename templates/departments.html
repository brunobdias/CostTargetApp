{% extends "layout.html" %}

{% block content %}

<h3 class="mb-4">Departments</h3>

<div class="table-responsive">
<table class="table table-bordered table-striped align-middle">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Department Name</th>
            <th>Active</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>

        {% for d in departments %}
        <tr>
            <td>{{ d.department_id }}</td>
            <td>{{ d.department_name }}</td>

            <td>
                {% if d.is_active %}
                    <span class="badge bg-success">Active</span>
                {% else %}
                    <span class="badge bg-secondary">Inactive</span>
                {% endif %}
            </td>

            <td>
                <!-- EDIT BUTTON (modal-style inline form) -->
                <button class="btn btn-primary btn-sm"
                        data-bs-toggle="collapse"
                        data-bs-target="#dept{{ d.department_id }}">
                    Edit
                </button>
            </td>
        </tr>

        <!-- Inline edit form -->
        <tr class="collapse bg-light" id="dept{{ d.department_id }}">
            <td colspan="4">

                <form method="POST"
                      action="{{ url_for('edit_department_page', dept_id=d.department_id) }}"
                      class="p-3 border rounded">

                    <div class="row g-3">

                        <div class="col-md-4">
                            <label class="form-label fw-bold">Department Name</label>
                            <input type="text"
                                   name="department_name"
                                   value="{{ d.department_name }}"
                                   class="form-control"
                                   required>
                        </div>

                        <div class="col-md-2">
                            <label class="form-label fw-bold">Active</label>
                            <select name="is_active" class="form-select">
                                <option value="1" {% if d.is_active %}selected{% endif %}>Active</option>
                                <option value="0" {% if not d.is_active %}selected{% endif %}>Inactive</option>
                            </select>
                        </div>

                        <div class="col-md-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-success w-100">Save</button>
                        </div>

                        <div class="col-md-3 d-flex align-items-end">
                            <button type="button"
                                    class="btn btn-secondary w-100"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#dept{{ d.department_id }}">
                                Cancel
                            </button>
                        </div>

                    </div>

                </form>

            </td>
        </tr>

        {% endfor %}

    </tbody>

</table>
</div>

{% endblock %}